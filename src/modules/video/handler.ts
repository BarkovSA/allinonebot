import { InlineKeyboard } from "grammy";
import { BotContext } from "../../types.ts";
import { setUserState, getUserState } from "../../middleware/state.ts";
import { BotMode } from "../../types.ts";

// –ú–æ–¥—É–ª—å —Å–æ–∑–¥–∞–Ω–∏—è –≤–∏–¥–µ–æ —Å —Ç–µ–∫—Å—Ç–æ–º –∏ —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏
// –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ - –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∏–¥–µ–æ (—Ç—Ä–µ–±—É–µ—Ç—Å—è ffmpeg)

export async function handleVideoCallback(ctx: BotContext) {
  const keyboard = new InlineKeyboard()
    .text("üìù –¶–∏—Ç–∞—Ç–∞", "video_quote")
    .text("üéâ –ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ", "video_celebration").row()
    .text("üí° –ú–æ—Ç–∏–≤–∞—Ü–∏—è", "video_motivation")
    .text("üì∞ –ù–æ–≤–æ—Å—Ç—å", "video_news").row()
    .text("üé® –ü—Ä–æ–º–æ", "video_promo")
    .text("üéµ –ú—É–∑—ã–∫–∞–ª—å–Ω–æ–µ", "video_music").row()
    .text("‚óÄÔ∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "back_to_menu");

  await ctx.editMessageText(
    `=============================
   üé• <b>–°–û–ó–î–ê–ù–ò–ï –í–ò–î–ï–û</b> üé•
=============================

<b>‚ú® –ü—Ä–µ–≤—Ä–∞—â–∞–π —Ç–µ–∫—Å—Ç –≤ –≤–∏–¥–µ–æ!</b>

-----------------------------
<b>üìã –¢–ò–ü–´ –í–ò–î–ï–û</b>
-----------------------------

üìù <b>–¶–∏—Ç–∞—Ç–∞</b>
   ‚Ä¢ –ö—Ä–∞—Å–∏–≤–∞—è –∞–Ω–∏–º–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞
   ‚Ä¢ –§–æ–Ω–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
   ‚Ä¢ –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π

üéâ <b>–ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ</b>
   ‚Ä¢ –ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
   ‚Ä¢ –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ –∏ —Ñ–µ–π–µ—Ä–≤–µ—Ä–∫–∏
   ‚Ä¢ –° –¥–Ω—ë–º —Ä–æ–∂–¥–µ–Ω–∏—è!

üí° <b>–ú–æ—Ç–∏–≤–∞—Ü–∏—è</b>
   ‚Ä¢ –í–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–µ —Å–ª–æ–≤–∞
   ‚Ä¢ –≠–Ω–µ—Ä–≥–∏—á–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã
   ‚Ä¢ –ó–∞—Ä—è–¥ –ø–æ–∑–∏—Ç–∏–≤–∞

üì∞ <b>–ù–æ–≤–æ—Å—Ç—å</b>
   ‚Ä¢ –°—Ç–∏–ª—å –Ω–æ–≤–æ—Å—Ç–µ–π
   ‚Ä¢ –ë–µ–≥—É—â–∞—è —Å—Ç—Ä–æ–∫–∞
   ‚Ä¢ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ

üé® <b>–ü—Ä–æ–º–æ</b>
   ‚Ä¢ –†–µ–∫–ª–∞–º–Ω—ã–π —Å—Ç–∏–ª—å
   ‚Ä¢ –Ø—Ä–∫–∏–µ –∞–∫—Ü–µ–Ω—Ç—ã
   ‚Ä¢ –ü—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ

üéµ <b>–ú—É–∑—ã–∫–∞–ª—å–Ω–æ–µ</b>
   ‚Ä¢ –°–∏–Ω—Ö—Ä–æ —Å –±–∏—Ç–æ–º
   ‚Ä¢ –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–≤—É–∫–∞
   ‚Ä¢ –î–ª—è –∫–ª–∏–ø–æ–≤

-----------------------------

‚öôÔ∏è <b>–ü–†–û–¶–ï–°–°:</b>

1Ô∏è‚É£ –í—ã–±–µ—Ä–∏ —Ç–∏–ø –≤–∏–¥–µ–æ
2Ô∏è‚É£ –ù–∞–ø–∏—à–∏ —Ç–µ–∫—Å—Ç
3Ô∏è‚É£ –ü–æ–ª—É—á–∏ –≥–æ—Ç–æ–≤–æ–µ –≤–∏–¥–µ–æ!

-----------------------------

‚è±Ô∏è <b>–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è:</b> ~10 —Å–µ–∫
üì± <b>–§–æ—Ä–º–∞—Ç:</b> MP4, 1080p
üé® <b>–°—Ç–∏–ª—å:</b> –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π

<b>‚è≥ –§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</b>
<i>–°–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞!</i>

<b>üëá –í—ã–±–µ—Ä–∏ —Ç–∏–ø –≤–∏–¥–µ–æ</b>`,
    {
      parse_mode: "HTML",
      reply_markup: keyboard,
    }
  );
  await ctx.answerCallbackQuery();
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≤–∏–¥–µ–æ
export async function handleVideoQuote(ctx: BotContext) {
  const userId = ctx.from?.id;
  if (userId) {
    setUserState(userId, BotMode.VideoQuote);
  }

  const keyboard = new InlineKeyboard()
    .text("‚óÄÔ∏è –ù–∞–∑–∞–¥", "menu_video");

  await ctx.editMessageText(
    `=============================
   üìù <b>–í–ò–î–ï–û –° –¶–ò–¢–ê–¢–û–ô</b> üìù
=============================

<b>‚úçÔ∏è –ù–∞–ø–∏—à–∏ —Ç–µ–∫—Å—Ç –¥–ª—è –≤–∏–¥–µ–æ</b>

-----------------------------
<b>üí° –ü–†–ò–ú–ï–†–´:</b>
-----------------------------

<i>"–ú–µ—á—Ç—ã —Å–±—ã–≤–∞—é—Ç—Å—è —É —Ç–µ—Ö,
–∫—Ç–æ –≤–µ—Ä–∏—Ç –≤ –∏—Ö –∫—Ä–∞—Å–æ—Ç—É"</i>
‚Äî –≠–ª–µ–æ–Ω–æ—Ä–∞ –†—É–∑–≤–µ–ª—å—Ç

<i>"–ñ–∏–∑–Ω—å - —ç—Ç–æ —Ç–æ, —á—Ç–æ —Å —Ç–æ–±–æ–π
–ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –ø–æ–∫–∞ —Ç—ã —Å—Ç—Ä–æ–∏—à—å
–¥—Ä—É–≥–∏–µ –ø–ª–∞–Ω—ã"</i>
‚Äî –î–∂–æ–Ω –õ–µ–Ω–Ω–æ–Ω

<i>"–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–¥–µ–ª–∞—Ç—å
—á—Ç–æ-—Ç–æ –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ - –ª—é–±–∏—Ç—å
—Ç–æ, —á—Ç–æ —Ç—ã –¥–µ–ª–∞–µ—à—å"</i>
‚Äî –°—Ç–∏–≤ –î–∂–æ–±—Å

-----------------------------

üìã <b>–°–û–í–ï–¢–´:</b>
‚úì –ö—Ä–∞—Ç–∫–∏–µ —Ñ—Ä–∞–∑—ã (2-4 —Å—Ç—Ä–æ–∫–∏)
‚úì –ì–ª—É–±–æ–∫–∏–π —Å–º—ã—Å–ª
‚úì –ú–æ–∂–Ω–æ —Å –∞–≤—Ç–æ—Ä–æ–º
‚úì –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ

-----------------------------

‚è≥ <b>–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–π–º—ë—Ç ~10 —Å–µ–∫—É–Ω–¥</b>

<b>‚úçÔ∏è –ù–∞–ø–∏—à–∏ —Å–≤–æ–π —Ç–µ–∫—Å—Ç:</b>`,
    {
      parse_mode: "HTML",
      reply_markup: keyboard,
    }
  );
  await ctx.answerCallbackQuery();
}

export async function handleVideoCelebration(ctx: BotContext) {
  await ctx.answerCallbackQuery("‚è≥ –ü–æ–∑–¥—Ä–∞–≤–∏—Ç–µ–ª—å–Ω—ã–µ –≤–∏–¥–µ–æ —Å–∫–æ—Ä–æ!");
}

export async function handleVideoMotivation(ctx: BotContext) {
  await ctx.answerCallbackQuery("‚è≥ –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –≤–∏–¥–µ–æ —Å–∫–æ—Ä–æ!");
}

export async function handleVideoNews(ctx: BotContext) {
  await ctx.answerCallbackQuery("‚è≥ –ù–æ–≤–æ—Å—Ç–Ω—ã–µ –≤–∏–¥–µ–æ —Å–∫–æ—Ä–æ!");
}

export async function handleVideoPromo(ctx: BotContext) {
  await ctx.answerCallbackQuery("‚è≥ –ü—Ä–æ–º–æ-–≤–∏–¥–µ–æ —Å–∫–æ—Ä–æ!");
}

export async function handleVideoMusic(ctx: BotContext) {
  await ctx.answerCallbackQuery("‚è≥ –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –≤–∏–¥–µ–æ —Å–∫–æ—Ä–æ!");
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –≤–∏–¥–µ–æ
export async function handleVideoMessage(ctx: BotContext) {
  const userId = ctx.from?.id;
  if (!userId) return;

  const state = getUserState(userId);
  if (state !== BotMode.VideoQuote) return;

  const text = ctx.message?.text;
  if (!text) return;

  // –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –∑–∞–≥–ª—É—à–∫–∞
  await ctx.reply(
    `‚è≥ <b>–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–µ–æ...</b>

üìù –¢–µ–∫—Å—Ç –ø–æ–ª—É—á–µ–Ω:
<i>"${text}"</i>

-----------------------------

üé¨ <b>–≠—Ç–∞–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏:</b>

‚úÖ –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞
‚úÖ –ü–æ–¥–±–æ—Ä —Ñ–æ–Ω–∞
‚úÖ –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
‚è≥ –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤–∏–¥–µ–æ...

-----------------------------

‚ö†Ô∏è <b>–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</b>

–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–∏–¥–µ–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è:
‚Ä¢ FFmpeg –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
‚Ä¢ –®—Ä–∏—Ñ—Ç—ã –∏ —à–∞–±–ª–æ–Ω—ã
‚Ä¢ –§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

<i>–°–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞!</i>`,
    {
      parse_mode: "HTML",
    }
  );

  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
  setUserState(userId, BotMode.MainMenu);
}
